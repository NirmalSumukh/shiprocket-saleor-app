# Query to fetch product details when PRODUCT_UPDATED webhook fires
fragment ProductWebhookFragment on Product {
  id
  name
  description
  slug
  created
  updatedAt
  category {
    name
  }
  thumbnail {
    url
  }
  defaultVariant {
    id
  }
  variants {
    id
    name
    sku
    quantityAvailable
    created
    updatedAt
    pricing {
      price {
        gross {
          amount
          currency
        }
      }
    }
    weight {
      value
      unit
    }
    media {
      url
    }
  }
  metadata {
    key
    value
  }
}

# Query to fetch collection details when COLLECTION_UPDATED webhook fires
fragment CollectionWebhookFragment on Collection {
  id
  name
  description
  slug
  backgroundImage {
    url
  }
  products(first: 1) {
    totalCount
  }
}

# Subscription payload for product updates
subscription ProductUpdated {
  event {
    ... on ProductUpdated {
      product {
        ...ProductWebhookFragment
      }
    }
  }
}

# Subscription payload for product variant updates
subscription ProductVariantUpdated {
  event {
    ... on ProductVariantUpdated {
      productVariant {
        id
        name
        sku
        quantityAvailable
        updatedAt
        pricing {
          price {
            gross {
              amount
              currency
            }
          }
        }
        weight {
          value
          unit
        }
        media {
          url
        }
        product {
          ...ProductWebhookFragment
        }
      }
    }
  }
}

# Subscription payload for collection updates
subscription CollectionUpdated {
  event {
    ... on CollectionUpdated {
      collection {
        ...CollectionWebhookFragment
      }
    }
  }
}
